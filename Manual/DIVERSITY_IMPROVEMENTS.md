# 다양성 개선 가이드

## 🎯 문제 상황

### **10개 문제 다양성 분석 결과**

**연령/성별 패턴:**
- "~세/대 남성이..." : 7개 (70%)
- 소아 문제 : 3개 (30%)
- 여성 문제 : 0개 (0%)

**주제 중복:**
- 심실세동/제세동 : 5개 (50%)
- 급성 폐부종 : 2개 (20%, 중복!)

**구조적 유사성:**
```
Few-shot: "심부전 병력이 있는 60대 남성이 두근거림으로..."
생성됨:   "심부전 병력이 있는 68세 남성이 극심한 호흡곤란으로..."
→ 거의 동일!
```

---

## 🔴 **원인 분석**

### **1. Few-shot 1개만 제공**
```python
few_shot_max_examples = 1  # 너무 적음!
```

**문제:**
- LLM이 단 1개 예시만 보고 학습
- 그 예시를 과도하게 모방
- 다양한 패턴 학습 불가

---

### **2. 프롬프트 부족**

현재 프롬프트:
```
"케이스 시나리오: 예시와 다른 연령/성별/상황으로 구성"
```

**문제:**
- 너무 일반적
- 구체적 제한 없음
- LLM이 쉽게 무시

---

## ✅ **개선 방안**

### **1. Few-shot 개수 증가**

```python
# config.py Line 339
few_shot_max_examples: 1 → 3
```

**효과:**
```
Before: 1개 예시
  → "40대 여성, 두근거림, 119 신고"만 학습
  → 이것만 따라함
  
After: 3개 예시
  → "40대 여성, 두근거림"
  → "50대 남성, 흉통"
  → "70대 남성, 호흡곤란"
  → 다양한 패턴 학습
  → 창의적 조합!
```

---

### **2. 프롬프트 강화**

#### **system_prompt.txt 추가**
```
**⚠️ 특별 주의: 시나리오 다양성 필수**
- 예시의 연령대, 성별, 발생 장소를 그대로 사용하지 마세요
- 매 문제마다 완전히 다른 상황을 창조하세요
- 동일한 케이스(연령/성별/상황) 반복 금지
```

#### **retriever_prompt.txt 추가**
```
**⚠️ 시나리오 다양성 필수 (매우 중요)**
- 예시: "40대 여성" → 생성: "20대 남성", "70대 여성", "중년 남성" 등
- 예시: "두근거림" → 생성: "흉통", "호흡곤란", "의식저하" 등
- 예시: "119 신고" → 생성: "현장 발견", "응급실 내원", "이송 중" 등
- **절대 금지:** 예시와 동일한 연령/성별/증상 조합 반복
- **매 문제마다** 완전히 새로운 케이스를 만드세요
```

---

## 📊 **예상 효과**

### **Before (Few-shot 1개)**
```
10개 문제:
  - "60대 남성" : 3개
  - "68세 남성" : 2개
  - "5세 소아" : 2개
  - "8세 소아" : 1개
  → 연령/성별 다양성: 4가지
```

### **After (Few-shot 3개 + 프롬프트 강화)**
```
10개 문제:
  - "20대 여성"
  - "30대 남성"
  - "중년 여성"
  - "노인 남성"
  - "5세 소아"
  - "10대 청소년"
  - "40대 남성"
  - "60대 여성"
  - "영아"
  - "성인"
  → 연령/성별 다양성: 10가지!
```

---

## 🧪 **테스트 방법**

```bash
python main.py
# 3. 전문심장소생술 → 10문제
```

**확인 사항:**
1. 연령/성별 다양성 (10개 중 최소 7-8가지)
2. 질문 시작 다양성 (10개 중 최소 8-9가지)
3. 주제 다양성 (동일 주제 2개 이하)

---

## ✅ 완료

- ✅ config.py: few_shot_max_examples 1 → 3
- ✅ system_prompt.txt: 시나리오 다양성 강조 추가
- ✅ retriever_prompt.txt: 구체적 다양성 가이드 추가

**이제 훨씬 다양한 문제가 생성될 것입니다!** 🎉

