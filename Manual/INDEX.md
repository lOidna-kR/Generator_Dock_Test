# Generator 프로젝트 문서

이 폴더는 Generator 프로젝트의 설계, 사용법, MCQ 생성 가이드를 담고 있습니다.

## 📚 문서 목록

### 🎯 시작 가이드

#### 1. PROJECT_README.md
**프로젝트 메인 문서**

Generator 프로젝트의 전체 개요와 빠른 시작 가이드입니다.

**내용:**
- 프로젝트 소개
- 주요 기능
- 빠른 시작 가이드
- 워크플로우 구조

---

#### 1-1. SETUP_INSTRUCTIONS.md
**초기 설정 가이드**

프로젝트 설치 및 환경 설정 방법을 설명합니다.

**내용:**
- 프로젝트 설치
- 환경 변수 설정
- Vertex AI 설정
- 의존성 설치

---

#### 1-2. ENVIRONMENT_SETUP.md
**개발 환경 설정 가이드**

개발 환경 구성 및 .env 파일 설정 방법을 설명합니다.

**내용:**
- Python 환경 설정
- .env 파일 구성
- API 키 설정
- 환경 변수 설명

---

### 📖 RAG 시스템 문서

#### 2. FINAL_PROJECT_STRUCTURE.md
**최종 프로젝트 구조 완전 가이드**

RAG 시스템의 전체 구조와 모든 리팩토링 내용이 정리된 **메인 문서**입니다.

**내용:**
- 최종 디렉토리 구조
- 모든 요구사항 적용 내역
- 각 모듈별 역할 및 책임
- 사용 방법 및 확장 가이드

---

#### 3. CONVERSATION_EXAMPLE.md
**대화형 RAG 시스템 사용 가이드**

`add_messages`를 활용한 대화 이력 관리 방법을 설명합니다.

**내용:**
- State에 messages 필드 활용법
- Multi-turn 대화 구현 방법
- Helper 함수 사용 예제
- 노드에서 대화 이력 활용법

**읽어야 하는 경우:**
- 대화형 챗봇으로 확장하고 싶을 때
- messages 필드를 활용하고 싶을 때
- 대화 맥락을 고려한 답변을 구현하고 싶을 때

---

### ⚙️ 최적화 및 문제 해결

#### 3-1. FINAL_SUMMARY.md ⭐
**MCQ 창의성 향상 최종 요약**

MCQ 생성 창의성 향상을 위한 최적화 작업 요약입니다.

**내용:**
- 검색 최적화 (initial_k, k, max_context_docs)
- 중복 방지 완화
- 프롬프트 최적화 (형태 모방 + 창의적 생성)
- ECG 케이스 가이드
- 테스트 결과 및 개선 효과

**읽어야 하는 경우:**
- MCQ 생성 품질을 이해하고 싶을 때
- 최적화 이력을 확인하고 싶을 때
- 창의성 향상 방법을 알고 싶을 때

---

#### 3-2. DUPLICATE_FIX_SUMMARY.md ⭐
**중복 문제 해결 요약**

리랭킹 제거 및 랜덤 샘플링으로 중복 문제를 해결한 과정입니다.

**내용:**
- 중복 발생 원인 분석
- 리랭킹 제거 결정
- 랜덤 샘플링 도입
- 속도 및 다양성 개선 효과

**읽어야 하는 경우:**
- 중복 문제 해결 방법을 알고 싶을 때
- 랜덤 샘플링 도입 이유를 이해하고 싶을 때
- 검색 성능 개선을 원할 때

---

#### 3-3. OPTIMIZATION_GUIDE.md
**시스템 최적화 가이드**

MCQ 생성 시스템의 최적화 방법 및 설정 가이드입니다.

**내용:**
- 검색 파라미터 최적화
- LLM Temperature 조정
- Few-shot 예시 개수 설정
- .env 파일 권장 설정

**읽어야 하는 경우:**
- 시스템 성능을 최적화하고 싶을 때
- 파라미터 조정 방법을 알고 싶을 때
- 생성 품질을 향상시키고 싶을 때

---

#### 3-4. UPDATE_ENV_GUIDE.txt
**.env 파일 업데이트 가이드**

환경 변수 설정 업데이트 방법을 설명합니다.

**내용:**
- .env 파일 수정 방법
- 최적화된 설정값
- 파라미터별 설명

---

#### 3-5. RHYTHM_DIVERSITY_FIX.md ⭐⭐
**심전도 리듬 다양성 강화 (프롬프트 개선)**

심실세동 과다 중복(6개, 60%) 문제를 해결한 과정입니다.

**내용:**
- 문제 상황: 심실세동 6개 (목표: 최대 2개)
- 핵심 원인: 리듬 규칙이 최우선 순위가 아님
- 해결 방법: 
  - 리듬 다양성 규칙을 최우선 순위로 이동
  - "3회 이상 금지" → "2회 초과 금지 (최대 2개)"
  - 13가지 리듬 목록 명시
  - 올바른/잘못된 예시 추가
- 발생 장소 중복 제한 추가 (등산 4회 → 최대 2회)

**읽어야 하는 경우:**
- 프롬프트 우선순위 설정을 이해하고 싶을 때
- 리듬 다양성 최적화 방법을 알고 싶을 때

---

#### 3-5-1. RHYTHM_TRACKING_SYSTEM.md ⭐⭐⭐ (최신, 근본 해결!)
**리듬 추적 시스템 (완전 자동화)**

프롬프트로 해결 불가능한 리듬 중복을 **시스템 레벨**에서 완전히 해결합니다.

**내용:**
- 문제 진단: 프롬프트만으로는 부족한 이유
- 3단계 방어선:
  1. State에 rhythm_counter 추적
  2. 프롬프트에 동적 제약 삽입
  3. 코드 레벨 강제 거부 (3회 이상)
- 구현 상세: Utils/rhythm_tracker.py, State, Node, main.py
- 워크플로우 및 사용 방법
- 기대 효과: 각 리듬 최대 2개 강제, 8-10가지 리듬 보장

**읽어야 하는 경우:**
- ⭐⭐⭐ 리듬 중복 문제를 **완전히** 해결하고 싶을 때
- 시스템 레벨 추적 메커니즘을 이해하고 싶을 때
- 다른 다양성 요소(연령, 장소)에도 적용하고 싶을 때

---

#### 3-5-2. CASE_SPECIFICITY_GUIDE.md ⭐
**현장 사례 구체화 가이드**

MCQ 문제를 실제 응급 현장처럼 구체적으로 만드는 방법입니다.

**내용:**
- Before/After 비교 (간결형 vs 현장 재현형)
- 6가지 구체화 요소:
  1. 시간/날씨 정보
  2. 장소 구체화 ("헬스장" → "피트니스센터 러닝머신")
  3. 발견 상황 (목격자, 초기 조치)
  4. 활력징후 2-3가지 우선순위
  5. 외관/임상 소견
  6. 간단한 병력 (필요 시)
- 3-5문장 원칙
- 리듬별 적용 예시
- 주의사항 (과도한 상세화 금지)

**읽어야 하는 경우:**
- 문제를 더 현장감 있게 만들고 싶을 때
- 실전 상황 판단력 훈련 문제를 원할 때
- 케이스 작성 템플릿을 참고하고 싶을 때

---

#### 3-5-3. ADVANCED_MCQ_STRATEGIES.md ⭐⭐⭐ (고급!)
**고급 MCQ 전략: 오답 고도화 & 질문 다양화**

난이도와 교육 효과를 극대화하는 고급 전략입니다.

**내용:**
- 사용자 피드백 기반 개선
- **전략 1: 오답 고도화 (3단계)**
  - Level 1: 명백한 오답 (30%)
  - Level 2: 그럴듯한 오답 (40%)
  - Level 3: 매우 미묘한 오답 (30%) - 우선순위 판단!
- **전략 2: 질문 형식 다양화 (5가지)**
  - 긍정형 (50%), 부정형 (20%), 단계형 (15%), 비교형 (10%), 복수선택형 (5%)
- 실전 적용 예시 (외상 PEA, 저체온, 불응성 VF)
- 기대 효과: 정답률 80% → 60%, 교육 효과 +31%

**읽어야 하는 경우:**
- ⭐⭐⭐ 문제 난이도를 높이고 싶을 때
- 임상 판단력을 평가하는 문제를 만들고 싶을 때
- "우선순위 판단" 능력을 평가하고 싶을 때
- 사고의 유연성을 평가하고 싶을 때

---

#### 3-5-4. PROMPT_OPTIMIZATION_FINAL.md ⭐⭐⭐ (최신, 최종!)
**프롬프트 최종 최적화**

발견된 모든 문제점을 해결한 최종 최적화 버전입니다.

**내용:**
- 발견된 문제점 5가지:
  1. 시간 다양성 부족 ("한겨울 새벽" 70%)
  2. 연령 집중 (20대 40%, 60대 30%)
  3. 질문 형식 불균형 (긍정 90%)
  4. 논리 중복 (문제 2, 8)
  5. 병력 정보 미활용
- 해결 방법:
  1. 시간대 분배 규칙 (새벽/오전/오후/저녁)
  2. 질문 형식 비율 엄수 (5:2:1-2:1:0-1)
  3. 병력 활용 강제 (5H5T 연결)
  4. 논리 중복 방지 명시
- 기대 효과: 모든 다양성 지표 +50~100% 개선

**읽어야 하는 경우:**
- ⭐⭐⭐ 프롬프트 전체 최적화 과정을 이해하고 싶을 때
- 다양성 문제를 완전히 해결하고 싶을 때
- 최종 완성본 프롬프트 구조를 파악하고 싶을 때

---

#### 3-6. DIVERSITY_IMPROVEMENTS.md
**다양성 개선 (연령/성별/증상/리듬)**

Few-shot 모방이 과도한 문제를 해결한 과정입니다.

**내용:**
- 연령, 성별, 발생 장소, 증상, 리듬 다양화 규칙 강화
- few_shot_max_examples 1 → 3 증가
- 시나리오 기반 중복 체크 추가 (regex 활용)

**읽어야 하는 경우:**
- 생성된 문제가 너무 비슷할 때
- 다양성 개선 방법을 알고 싶을 때

---

#### 3-7. PROMPT_STRUCTURE_FIX.md
**프롬프트 구조 개선 (형태 모방 vs 내용 창의)**

"형태는 모방, 내용은 창의적"으로 프롬프트를 재구성한 과정입니다.

**내용:**
- 모방 요소 (형태/스타일): [Image] 위치, 질문 구조, <보기> 위치
- 창의 요소 (논리/시나리오): 환자 케이스, 질문 논리, 리듬 다양화
- system_prompt.txt, retriever_prompt.txt 수정

**읽어야 하는 경우:**
- 프롬프트 구조를 이해하고 싶을 때
- 형태/내용 균형을 조정하고 싶을 때

---

#### 3-8. DUPLICATE_VALIDATION_CHANGES.md
**중복 검증 로직 완화**

중복 검증이 너무 타이트한 문제를 해결한 과정입니다.

**내용:**
- section/document ID 중복 체크 완화 (70% 이상)
- chapter 유사도 threshold 상향 (0.75 → 0.85)
- option 일치 개수 변경 (3 → 4)
- 시나리오 기반 중복 체크 추가

**읽어야 하는 경우:**
- 중복 검증 로직을 조정하고 싶을 때
- 중복 false positive 문제를 해결하고 싶을 때

---

### 🎓 MCQ 생성 시스템 문서

#### 4. MCQ_LANGGRAPH_README.md ⭐
**MCQ Generator 완전 가이드**

LangGraph 기반 MCQ 자동 생성 시스템의 전체 설명서입니다.

**내용:**
- MCQ Generator 개요 및 특징
- 파일 구조 및 워크플로우
- 중첩 선택 방식 설명
- 사용 예시
- 기존 Generator_MCQ와 비교

**읽어야 하는 경우:**
- MCQ 생성 시스템을 처음 사용할 때
- 중첩 선택 구조를 이해하고 싶을 때
- LangGraph 방식의 MCQ 생성을 배우고 싶을 때

---

#### 5. FEW_SHOT_GUIDE.md
**Few-shot Learning 완전 가이드**

Few-shot 예시 관리 및 프롬프트 통합 시스템 설명서입니다.

**내용:**
- Few-shot JSON 파일 형식
- 자동 로드 시스템
- 프롬프트 빌드 과정
- 예시 작성 가이드
- 유틸리티 함수 설명

**읽어야 하는 경우:**
- Few-shot 예시를 추가/수정하고 싶을 때
- MCQ 품질을 향상시키고 싶을 때
- JSON 파일 관리 방법을 알고 싶을 때

---

#### 6. EXAMPLE_MCQ_LANGGRAPH.md
**MCQ Generator 사용 예시**

다양한 MCQ 생성 시나리오의 실제 코드 예시입니다.

**내용:**
- 기본 사용법
- 중첩 선택 예시
- 배치 생성
- 통계 및 히스토리
- 와일드카드 사용

**읽어야 하는 경우:**
- MCQ 생성 코드 예시를 보고 싶을 때
- 다양한 선택 전략을 알고 싶을 때
- 실전 활용법을 배우고 싶을 때

---

#### 7. HYBRID_RETRY_STRATEGY.md
**하이브리드 재시도 전략 가이드**

MCQ 생성 실패 시 지능형 재시도 시스템 설명서입니다.

**내용:**
- 재시도 전략 개요 (1-5회: retrieve, 6회: select_part)
- 재시도 흐름 및 시뮬레이션
- 왜 하이브리드 방식인가?
- 설정 방법

**읽어야 하는 경우:**
- 재시도 로직을 이해하고 싶을 때
- max_retries 값을 조정하고 싶을 때
- 검증 실패 처리를 알고 싶을 때

---

#### 8. PROJECT_STRUCTURE.md
**프로젝트 구조 요약**

전체 프로젝트의 파일 구조와 역할을 요약한 문서입니다.

**내용:**
- 전체 디렉토리 구조
- 파일별 역할 설명
- 사용 방법
- 통계

---

### 🔧 시스템 개선 및 에러 처리

#### 9. ERROR_HANDLING_GUIDE.md
**에러 처리 가이드**

시스템 에러 처리 방식 및 복구 전략을 설명합니다.

**내용:**
- 에러 핸들링 구조
- 재시도 전략
- 에러 로깅
- 복구 메커니즘

---

#### 10. LOGGING_IMPROVEMENTS.md
**로깅 개선 가이드**

시스템 로깅 구조 및 활용 방법을 설명합니다.

**내용:**
- 로깅 레벨 설정
- 로그 포맷
- 디버깅 방법
- 성능 모니터링

---

#### 11. INTEGRATED_SYSTEM_GUIDE.md
**통합 시스템 가이드**

전체 시스템의 통합 및 운영 가이드입니다.

**내용:**
- 시스템 아키텍처
- 모듈 간 통합
- 워크플로우 전체 흐름
- 운영 가이드

---

### 🔧 리팩토링 가이드 (레거시)

#### 12. REFACTORING_NODE_STRUCTURE.md
**Node 모듈 리팩토링 가이드**

formatting.py를 제거하고 기능별로 병합한 과정을 설명합니다.

**내용:**
- formatting.py 제거 이유
- retrieval.py, generation.py로 병합 과정
- 기능별 그룹화의 장점
- Before/After 비교

**읽어야 하는 경우:**
- Node 모듈 구조를 이해하고 싶을 때
- 왜 포맷팅 노드가 분산되어 있는지 궁금할 때
- 새로운 노드 추가 시 어디에 배치할지 결정할 때

---

#### 13. REMOVE_ERROR_HANDLER.md
**Error Handler 노드 제거 가이드**

복잡한 에러 처리 구조를 단순화한 과정을 설명합니다.

**내용:**
- error_handler.py 제거 이유
- 각 노드의 자체 에러 처리 방식
- 조건부 엣지 제거 과정
- 선형 워크플로우의 장점

**읽어야 하는 경우:**
- 에러 처리 방식을 이해하고 싶을 때
- 왜 조건부 엣지가 없는지 궁금할 때
- 새로운 에러 처리 로직 추가 시 참고

---

#### 14. EDGE_MODULE_RESTRUCTURE.md
**Edge 모듈 재구성 가이드**

엣지 로직을 중앙에서 관리하도록 재구성한 과정을 설명합니다.

**내용:**
- Edge 모듈의 역할
- build_workflow_edges() 함수 설명
- 조건부 엣지 확장 방법
- WorkflowEdgeConfig 사용법

**읽어야 하는 경우:**
- 워크플로우 엣지를 수정하고 싶을 때
- 조건부 분기를 추가하고 싶을 때
- 재시도/캐싱 등 확장 기능을 구현하고 싶을 때

---

## 📖 읽기 순서 (권장)

### 🎯 처음 프로젝트를 접하는 경우
1. **PROJECT_README.md** (프로젝트 소개)
2. **SETUP_INSTRUCTIONS.md** (초기 설정)
3. **ENVIRONMENT_SETUP.md** (환경 설정)

### 🎓 MCQ 시스템을 사용하는 경우
1. **MCQ_LANGGRAPH_README.md** ⭐ (MCQ 시스템 전체)
2. **FEW_SHOT_GUIDE.md** (Few-shot 설정)
3. **FINAL_SUMMARY.md** ⭐ (창의성 향상 최적화)
4. **DUPLICATE_FIX_SUMMARY.md** ⭐ (중복 문제 해결)
5. **RHYTHM_DIVERSITY_FIX.md** ⭐⭐ (프롬프트 개선)
6. **RHYTHM_TRACKING_SYSTEM.md** ⭐⭐⭐ (리듬 추적 시스템)
7. **CASE_SPECIFICITY_GUIDE.md** ⭐ (현장 사례 구체화)
8. **ADVANCED_MCQ_STRATEGIES.md** ⭐⭐⭐ (오답 고도화 & 질문 다양화)
9. **PROMPT_OPTIMIZATION_FINAL.md** ⭐⭐⭐ (최종 최적화, 최신!)

### ⚙️ 시스템 최적화가 필요한 경우
1. **OPTIMIZATION_GUIDE.md** (최적화 가이드)
2. **UPDATE_ENV_GUIDE.txt** (.env 설정)
3. **FINAL_SUMMARY.md** (적용 효과 확인)

### 🔧 특정 기능을 추가하고 싶은 경우
- MCQ 생성 → **MCQ_LANGGRAPH_README.md**
- Few-shot 예시 추가 → **FEW_SHOT_GUIDE.md**
- 시스템 최적화 → **OPTIMIZATION_GUIDE.md**
- 중복 문제 → **DUPLICATE_FIX_SUMMARY.md**
- 리듬 다양성 (프롬프트) → **RHYTHM_DIVERSITY_FIX.md** ⭐⭐
- 리듬 다양성 (시스템) → **RHYTHM_TRACKING_SYSTEM.md** ⭐⭐⭐
- 현장 사례 구체화 → **CASE_SPECIFICITY_GUIDE.md** ⭐
- 문제 난이도 & 질문 다양화 → **ADVANCED_MCQ_STRATEGIES.md** ⭐⭐⭐
- **프롬프트 최종 최적화** → **PROMPT_OPTIMIZATION_FINAL.md** ⭐⭐⭐ (최신!)
- 다양성 개선 → **DIVERSITY_IMPROVEMENTS.md**
- 프롬프트 구조 → **PROMPT_STRUCTURE_FIX.md**
- 중복 검증 완화 → **DUPLICATE_VALIDATION_CHANGES.md**
- 에러 처리 → **ERROR_HANDLING_GUIDE.md**
- 로깅 → **LOGGING_IMPROVEMENTS.md**

### 📋 유지보수 시
- **INDEX.md** (이 파일)에서 관련 문서 찾기
- 해당 문서의 가이드 참고

---

## 🎯 문서 작성 배경

이 문서들은 프로젝트 리팩토링 과정에서 작성되었습니다:

1. **State 타입 정확성 개선**
   - 실제 사용과 일치하도록 수정
   - messages 필드 추가 (대화형 확장 대비)

2. **Node 모듈 구조 개선**
   - formatting.py 제거 및 기능별 병합
   - 높은 응집도, 낮은 결합도 달성

3. **에러 처리 단순화**
   - error_handler.py 제거
   - 각 노드의 자체 완결성 강화

4. **Edge 모듈 중앙화**
   - 엣지 로직 중앙 관리
   - 향후 조건부 확장 준비

---

## 🔗 관련 코드

각 문서에서 설명하는 실제 코드 위치:

| 문서 | 관련 코드 |
|------|----------|
| FINAL_PROJECT_STRUCTURE.md | 전체 프로젝트 |
| CONVERSATION_EXAMPLE.md | State/state.py, Node/generation.py |
| REFACTORING_NODE_STRUCTURE.md | Node/retrieval.py, Node/generation.py |
| REMOVE_ERROR_HANDLER.md | Core/Generator.py, Node/* |
| EDGE_MODULE_RESTRUCTURE.md | Edge/workflow_edges.py, Core/Generator.py |

---

## 📝 문서 업데이트 정책

이 문서들은 프로젝트의 설계 결정과 구조를 기록한 것입니다.

- 코드 변경 시 관련 문서도 업데이트하세요
- 새로운 기능 추가 시 문서에 예제 추가하세요
- 설계 변경 시 해당 가이드 문서 수정하세요

---

**작성일: 2025-10-18**
**프로젝트: LangGraph Generator**

